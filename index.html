<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BetX - Sistema de Apuestas Fibonacci</title>
    <style>
      body {
        font-family: "Courier New", Courier, monospace;
        text-align: center;
        padding: 20px;
      }
      .button {
        padding: 10px 20px;
        margin: 10px;
        font-family: "Courier New", Courier, monospace;
        font-size: 16px;
        cursor: pointer;
        color: white;
        border: 0;
      }
      .bg-red {
        background-color: rgb(157, 62, 62);
      }
      .bg-green {
        background-color: rgb(69, 130, 69);
      }
      .bg-blue {
        background-color: rgb(71, 71, 137);
      }
      .result {
        margin: 20px;
        font-size: 20px;
        font-weight: bold;
      }
      .unit {
        width: 100px;
        text-align: right;
      }
      .history {
        max-width: 300px;
        margin: 20px auto;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h1>BetX</h1>
    <h2>Sistema de Apuestas Fibonacci</h2>

    <div class="result">
      <label for="balance" class="result"> Saldo: </label>
      <input
        type="number"
        id="balance"
        class="result unit"
        value="0"
        min="0"
        step="100"
      />
      <label for="bet-unit" class="result"> Valor de la unidad: </label>
      <input
        type="number"
        id="bet-unit"
        class="result unit"
        value="100"
        min="100"
        step="100"
      />
      <label for="bet-quote" class="result"> Cuota: </label>
      <input
        type="number"
        id="bet-quote"
        class="result unit"
        value="1.30"
        min="1"
        step="0.01"
      />
    </div>

    <div class="result"></div>

    <div class="result" id="bet-number"></div>
    <div class="result" id="current-bet"></div>
    <div class="result" id="fibonacci-sequence"></div>

    <div>
      <button class="button bg-green" id="bet-win">Ganada</button>
      <button class="button bg-red" id="bet-lose">Perdida</button>
      <button class="button bg-blue" id="reset-sequence">Reiniciar</button>
    </div>

    <div class="history">
      <ol id="history"></ol>
    </div>

    <script>
      var fibonacciSequence = [1, 1]; // Iniciamos la secuencia de Fibonacci
      var currentPosition = 0; // Posición actual en la secuencia
      var currentBet = fibonacciSequence[currentPosition];
      var betNumber = 0;

      function addHistory(bet, result) {
        var history = document.getElementById("history");

        var item = document.createElement("li");
        item.className = "history";
        var icon = "🟢";
        if (!result) icon = "🔴";

        item.innerText = `${new Date().toLocaleString()} $${bet} ${icon}`;

        history.appendChild(item);
      }

      function clearHistory() {
        var history = document.getElementById("history");
        history.innerHTML = "";
      }

      // Actualiza la visualización de la apuesta y la secuencia
      function updateDisplay() {
        betUnit = parseInt(document.getElementById("bet-unit").value) || 1;

        document.getElementById(
          "current-bet"
        ).innerText = `Apostar: $${currentBet * betUnit} (${currentBet} unidades)`;

        document.getElementById(
          "fibonacci-sequence"
        ).innerText = `Secuencia de Fibonacci: [${fibonacciSequence.join(
          ", "
        )}]`;

        document.getElementById(
          "bet-number"
        ).innerText = `Próxima apuesta es la N°: ${betNumber + 1}`;
      }

      // Acción cuando se gana la apuesta
      document.getElementById("bet-win").addEventListener("click", () => {
        if (currentPosition > 1) {
          currentPosition -= 2; // Retrocede dos posiciones en la secuencia
        } else {
          currentPosition = 0; // Si está al inicio, regresa a la primera posición
        }

        betNumber = betNumber + 1;
        currentBet = fibonacciSequence[currentPosition];
        betUnit = parseInt(document.getElementById("bet-unit").value) || 1;
        var quote = parseFloat(document.getElementById("bet-quote").value);
        var betResult = currentBet * betUnit * quote;

        var balance = parseFloat(document.getElementById("balance").value);
        balance = balance + betResult;
        document.getElementById("balance").value = balance;

        addHistory(betResult, true);

        updateDisplay();
      });

      // Acción cuando se pierde la apuesta
      document.getElementById("bet-lose").addEventListener("click", () => {
        currentPosition++;
        if (currentPosition >= fibonacciSequence.length) {
          // Si se necesita un nuevo número de Fibonacci, se genera y agrega a la secuencia
          fibonacciSequence.push(
            fibonacciSequence[fibonacciSequence.length - 1] +
              fibonacciSequence[fibonacciSequence.length - 2]
          );
        }
        betNumber = betNumber + 1;
        currentBet = fibonacciSequence[currentPosition];
        betResult = currentBet * betUnit * -1;
        betUnit = parseInt(document.getElementById("bet-unit").value) || 1;

        var balance = parseFloat(document.getElementById("balance").value);
        balance = balance + betResult;
        document.getElementById("balance").value = balance;

        addHistory(betResult, false);

        updateDisplay();
      });

      // Acción para reiniciar la secuencia
      document
        .getElementById("reset-sequence")
        .addEventListener("click", () => {
          fibonacciSequence = [1, 1]; // Reinicia la secuencia de Fibonacci
          currentPosition = 0; // Regresa a la primera posición
          currentBet = fibonacciSequence[currentPosition]; // Restablece la apuesta actual
          betNumber = 0;

          clearHistory(); // Limpia la historia

          updateDisplay(); // Actualiza la visualización
        });

      // Inicializa la visualización
      updateDisplay();
    </script>
  </body>
</html>